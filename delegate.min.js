!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).delegate=t()}(this,(function(){"use strict";
/**
     * @preserve delegate (c) KNOWLEDGECODE | MIT
     */Element.prototype.matches||(Element.prototype.matches=Element.prototype.webkitMatchesSelector||Element.prototype.msMatchesSelector);const e=new WeakMap,t=(e,t)=>{for(let s=0,r=e.length;s<r;s++)t(e[s],s)},s=(e,s)=>{const r=[[],[]];return t(e,e=>s(e)?r[0].push(e):r[1].push(e)),r};class r{constructor(e,t){this.originalEvent=e,this.stop=!e.bubbles,this.abort=!1,this.currentTarget=t}preventDefault(){this.originalEvent.preventDefault()}stopPropagation(){this.stop=!0}stopImmediatePropagation(){this.abort=this.stop=!0}}class n{constructor(e){return this._baseEventTarget=e,this._eventCache={},this._subscribers={},this}listener(e){let t,n=this._subscribers[e.type]||[],i=e.target;if(n.length){for(;(i||{}).parentNode;){if([t,n]=s(n,(t=>s=>t.matches(s.selector)||!s.selector&&t===e.currentTarget)(i)),t.length){const s=new r(e,i);for(let e=0,r=t.length;e<r;e++)if(t[e].handler.call(i,s),s.abort)return;if(!n.length||s.stop)return}i=i.parentNode}if([t]=s(n,e=>!e.selector),t.length){i=e.currentTarget;const s=new r(e,i);for(let e=0,r=t.length;e<r;e++)if(t[e].handler.call(i,s),s.abort)return}}}on(e,t,s){"function"==typeof t&&(s=t,t=null);const r=this._subscribers[e]=this._subscribers[e]||[];if(!((e,t)=>{for(let s=0,r=e.length;s<r;s++)if(t(e[s]))return e[s]})(r,e=>e.selector===t&&e.handler===s)&&(r.push({selector:t,handler:s}),!this._eventCache[e])){const t=this.listener.bind(this);this._eventCache[e]=t,this._baseEventTarget.addEventListener(e,t,!0)}return this}off(e,t,s){return"function"==typeof t&&(s=t,t=null),e?t||s?(this._subscribers[e]=(this._subscribers[e]||[]).filter(e=>e.selector===t&&(!s||e.handler===s)),this._subscribers[e].length||delete this._subscribers[e]):delete this._subscribers[e]:this._subscribers={},this}one(e,t,s){const r=this,n=function(i){r.off(e,t||n,n),s.call(this,i)};return"function"==typeof t?(s=t,t=null,this.on(e,n)):this.on(e,t,n)}clear(){this.off(),t(Object.keys(this._eventCache),e=>{this._baseEventTarget.removeEventListener(e,this._eventCache[e],!0)}),this._eventCache={},e.delete(this._baseEventTarget)}}return t=>{if("function"!=typeof t.addEventListener)throw new TypeError(t+" is not an EventTarget");return e.get(t)||(()=>{const s=new n(t);return e.set(t,s),s})()}}));
