/**
 * @preserve delegate (c) KNOWLEDGECODE | MIT
 */
let e=[];const t=(e,t)=>{for(let s=0,r=e.length;s<r;s++)if(t(e[s]))return s;return-1},s=(e,s)=>e[t(e,s)],r=(e,t)=>{const s=[],r=[];for(let n=0,h=e.length;n<h;n++)t(e[n])?s.push(e[n]):r.push(e[n]);return[s,r]},n=(e,t)=>{for(let s=0,r=e.length;s<r;s++)t(e[s])};class h{constructor(e,t){this.originalEvent=e,this.stop=!e.bubbles,this.abort=!1,this.currentTarget=t}preventDefault(){this.originalEvent.preventDefault()}stopPropagation(){this.stop=!0}stopImmediatePropagation(){this.abort=this.stop=!0}}class i{constructor(e){return this._baseEventTarget=e,this._handlerCache={},this._subscribers={},this._eventCache=[],this}listener(e){let t=this._subscribers[e.type]||[],s=e.target||{};for(;s.parentNode;){const n=new h(e,s),[i,a]=r(t,(e=>t=>e.matches(t.selector))(s));for(let e=0,t=i.length;e<t&&(i[e].handler.call(s,n),!n.abort);e++);if(!a.length||n.stop)break;t=a,s=s.parentNode||{}}}on(e,t,r){if("function"==typeof t&&(r=t,t=null),t){const n=this._subscribers[e]=this._subscribers[e]||[];if(!s(n,e=>e.selector===t&&e.handler===r)&&(n.push({selector:t,handler:r}),!this._handlerCache[e])){const t=this.listener.bind(this);this._handlerCache[e]=t,this._baseEventTarget.addEventListener(e,t,!0)}}else s(this._eventCache,t=>t.eventName===e&&t.handler===r)||(this._eventCache.push({eventName:e,handler:r}),this._baseEventTarget.addEventListener(e,r,!0));return this}off(e,s,h){if("function"==typeof s&&(h=s,s=null),e)if(s||h)if(s)this._subscribers[e]=(this._subscribers[e]||[]).filter(e=>e.selector===s&&(!h||e.handler===h)),this._subscribers[e].length||delete this._subscribers[e];else{const s=t(this._eventCache,t=>t.eventName===e&&t.handler===h);s>-1&&(this._baseEventTarget.removeEventListener(e,h,!0),delete this._eventCache[s])}else{delete this._subscribers[e];const[t,s]=r(this._eventCache,t=>t.eventName===e);n(t,t=>this._baseEventTarget.removeEventListener(e,t.handler,!0)),this._eventCache=s}else this._subscribers={},n(this._eventCache,e=>this._baseEventTarget.removeEventListener(e.eventName,e.handler,!0)),this._eventCache=[];return this}one(e,t,s){const r=this,n=function(h){r.off(e,t||n,n),s.call(this,h)};return"function"==typeof t?(s=t,t=null,this.on(e,n)):this.on(e,t,n)}clear(){this.off(),n(Object.keys(this._handlerCache),e=>this._baseEventTarget.removeEventListener(e,this._handlerCache[e],!0)),this._handlerCache={},e=e.filter(e=>this._baseEventTarget!==e.baseEventTarget)}}export default t=>{if(!t instanceof EventTarget)throw new TypeError(t+" is not an EventTarget");return(s(e,e=>t===e.baseEventTarget)||(e.push({baseEventTarget:t,delegator:new i(t)}),e.slice(-1)[0])).delegator};
