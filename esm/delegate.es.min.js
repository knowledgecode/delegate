/*
 delegate (c) KNOWLEDGECODE | MIT
*/
Element.prototype.matches||(Element.prototype.matches=Element.prototype.webkitMatchesSelector||Element.prototype.msMatchesSelector);let f=new WeakMap,h=(a,b)=>{for(let c=0,d=a.length;c<d;c++)if(b(a[c]))return a[c]},k=(a,b)=>{for(let c=0,d=a.length;c<d;c++)b(a[c],c)},l=(a,b)=>{const c=[[],[]];k(a,a=>b(a)?c[0].push(a):c[1].push(a));return c};
class m{constructor(a,b){this.originalEvent=a;this.stop=!a.bubbles;this.abort=!1;this.currentTarget=b}preventDefault(){this.originalEvent.preventDefault()}stopPropagation(){this.stop=!0}stopImmediatePropagation(){this.abort=this.stop=!0}}
class n{constructor(a){this._baseEventTarget=a;this._eventCache={};this._subscribers={};return this}listener(a){var b=this._subscribers[a.type]||[];let c=a.target,d;if(b.length){for(;(c||{}).parentNode;){[d,b]=l(b,(b=>c=>b.matches(c.selector)||!c.selector&&b===a.currentTarget)(c));if(d.length){let e=new m(a,c);for(let a=0,b=d.length;a<b;a++)if(d[a].handler.call(c,e),e.abort)return;if(!b.length||e.stop)return}c=c.parentNode}[d]=l(b,a=>!a.selector);if(d.length){c=a.currentTarget;b=new m(a,c);for(let a=
0,g=d.length;a<g&&(d[a].handler.call(c,b),!b.abort);a++);}}}on(a,b,c){"function"===typeof b&&(c=b,b=null);var d=this._subscribers[a]=this._subscribers[a]||[];h(d,a=>a.selector===b&&a.handler===c)||(d.push({selector:b,handler:c}),this._eventCache[a]||(d=this.listener.bind(this),this._eventCache[a]=d,this._baseEventTarget.addEventListener(a,d,!0)));return this}off(a,b,c){"function"===typeof b&&(c=b,b=null);a?b||c?(this._subscribers[a]=(this._subscribers[a]||[]).filter(a=>a.selector!==b||c&&a.handler!==
c),this._subscribers[a].length||delete this._subscribers[a]):delete this._subscribers[a]:this._subscribers={};return this}one(a,b,c){function d(g){e.off(a,b||d,d);c.call(this,g)}let e=this;return"function"===typeof b?(c=b,b=null,this.on(a,d)):this.on(a,b,d)}clear(){this.off();k(Object.keys(this._eventCache),a=>{this._baseEventTarget.removeEventListener(a,this._eventCache[a],!0)});this._eventCache={};f.delete(this._baseEventTarget)}}
export default a=>{if("function"!==typeof a.addEventListener)throw new TypeError(`${a} is not an EventTarget`);var b;(b=f.get(a))||(b=new n(a),f.set(a,b));return b}
