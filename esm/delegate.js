/*
 delegate (c) KNOWLEDGECODE | MIT
*/
Element.prototype.matches||(Element.prototype.matches=Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector);let e=new WeakMap;class f{constructor(a,b){this.originalEvent=a;this.stop=!a.bubbles;this.abort=!1;this.currentTarget=b}preventDefault(){this.originalEvent.preventDefault()}stopPropagation(){this.stop=!0}stopImmediatePropagation(){this.abort=this.stop=!0}}
class g{constructor(a){this._baseEventTarget=a;this._eventCache={};this._subscribers={}}listener(a,b){a=this._subscribers[b.type+a]||[];let c=b.currentTarget===window?window:b.target;do{let d=new f(b,c);a=a.filter((a=>c=>d.abort?!1:a===b.currentTarget?(c.selector||c.handler.call(a,d),!1):c.selector&&a.matches(c.selector)?(c.handler.call(a,d),!1):!0)(c));if(!a.length||d.stop)break}while(c=c.parentNode)}on(a,b,c){"function"===typeof b&&(c=b,b=null);var d=this._subscribers[a]=this._subscribers[a]||[];
if(!d.some(a=>a.selector===b&&a.handler===c)&&(d.push({selector:b,handler:c}),!this._eventCache[a])){let [b,c]=a.split(":");d=this.listener.bind(this,"passive"===c?":passive":"");this._eventCache[a]=d;this._baseEventTarget.addEventListener(b,d,{capture:!0,passive:"passive"===c})}return this}off(a,b,c){"function"===typeof b&&(c=b,b=null);a?b||c?(this._subscribers[a]=(this._subscribers[a]||[]).filter(a=>a.selector!==b||c&&a.handler!==c),this._subscribers[a].length||delete this._subscribers[a]):delete this._subscribers[a]:
this._subscribers={};return this}one(a,b,c){function d(k){h.off(a,b||d,d);c.call(this,k)}let h=this;return"function"===typeof b?(c=b,b=null,this.on(a,d)):this.on(a,b,d)}clear(){this.off();Object.keys(this._eventCache).forEach(a=>{let [b,c]=a.split(":");this._baseEventTarget.removeEventListener(b,this._eventCache[a],{capture:!0,passive:"passive"===c})});this._eventCache={};e.delete(this._baseEventTarget)}}
export default a=>{if("function"!==typeof a.addEventListener)throw new TypeError(`${a} is not an EventTarget`);var b;(b=e.get(a))||(b=new g(a),e.set(a,b));return b}
